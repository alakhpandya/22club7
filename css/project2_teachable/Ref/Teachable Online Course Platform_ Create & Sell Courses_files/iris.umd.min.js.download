!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.iris={})}(this,function(t){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function n(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n}var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r="undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{},i=function(t){var e=a.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)},a=Object.prototype.toString;var s,c=(function(t,e){(e=t.exports=function(t){return t.replace(/^\s*|\s*$/g,"")}).left=function(t){return t.replace(/^\s*/,"")},e.right=function(t){return t.replace(/\s*$/,"")}}(s={exports:{}},s.exports),s.exports),u=(c.left,c.right,Function.prototype.toString),f=/^\s*class\b/,l=function(t){try{var e=u.call(t);return f.test(e)}catch(t){return!1}},p=Object.prototype.toString,d="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,h=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if("function"==typeof t&&!t.prototype)return!0;if(d)return function(t){try{return!l(t)&&(u.call(t),!0)}catch(t){return!1}}(t);if(l(t))return!1;var e=p.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e},m=Object.prototype.toString,y=Object.prototype.hasOwnProperty,v=function(t,e,n){if(!h(e))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=n),"[object Array]"===m.call(t)?function(t,e,n){for(var o=0,r=t.length;o<r;o++)y.call(t,o)&&(null==n?e(t[o],o,t):e.call(n,t[o],o,t))}(t,e,o):"string"==typeof t?function(t,e,n){for(var o=0,r=t.length;o<r;o++)null==n?e(t.charAt(o),o,t):e.call(n,t.charAt(o),o,t)}(t,e,o):function(t,e,n){for(var o in t)y.call(t,o)&&(null==n?e(t[o],o,t):e.call(n,t[o],o,t))}(t,e,o)},b=function(t){if(!t)return{};var e={};return v(c(t).split("\n"),function(t){var n,o=t.indexOf(":"),r=c(t.slice(0,o)).toLowerCase(),i=c(t.slice(o+1));void 0===e[r]?e[r]=i:(n=e[r],"[object Array]"===Object.prototype.toString.call(n)?e[r].push(i):e[r]=[e[r],i])}),e},w=function(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var o in n)g.call(n,o)&&(t[o]=n[o])}return t},g=Object.prototype.hasOwnProperty;var x=T,E=T;function O(t,e,n){var o=t;return i(e)?(n=e,"string"==typeof t&&(o={uri:t})):o=w(e,{uri:t}),o.callback=n,o}function T(t,e,n){return R(e=O(t,e,n))}function R(t){if(void 0===t.callback)throw new Error("callback argument missing");var e=!1,n=function(n,o,r){e||(e=!0,t.callback(n,o,r))};function o(){var t=void 0;if(t=c.response?c.response:c.responseText||function(t){try{if("document"===t.responseType)return t.responseXML;var e=t.responseXML&&"parsererror"===t.responseXML.documentElement.nodeName;if(""===t.responseType&&!e)return t.responseXML}catch(t){}return null}(c),m)try{t=JSON.parse(t)}catch(t){}return t}function r(t){return clearTimeout(u),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,n(t,y)}function i(){if(!s){var e;clearTimeout(u),e=t.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var r=y,i=null;return 0!==e?(r={body:o(),statusCode:e,method:l,headers:{},url:f,rawRequest:c},c.getAllResponseHeaders&&(r.headers=b(c.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),n(i,r,r.body)}}var a,s,c=t.xhr||null;c||(c=t.cors||t.useXDR?new T.XDomainRequest:new T.XMLHttpRequest);var u,f=c.url=t.uri||t.url,l=c.method=t.method||"GET",p=t.body||t.data,d=c.headers=t.headers||{},h=!!t.sync,m=!1,y={body:void 0,headers:{},statusCode:0,method:l,url:f,rawRequest:c};if("json"in t&&!1!==t.json&&(m=!0,d.accept||d.Accept||(d.Accept="application/json"),"GET"!==l&&"HEAD"!==l&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),p=JSON.stringify(!0===t.json?p:t.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(i,0)},c.onload=i,c.onerror=r,c.onprogress=function(){},c.onabort=function(){s=!0},c.ontimeout=r,c.open(l,f,!h,t.username,t.password),h||(c.withCredentials=!!t.withCredentials),!h&&t.timeout>0&&(u=setTimeout(function(){if(!s){s=!0,c.abort("timeout");var t=new Error("XMLHttpRequest timeout");t.code="ETIMEDOUT",r(t)}},t.timeout)),c.setRequestHeader)for(a in d)d.hasOwnProperty(a)&&c.setRequestHeader(a,d[a]);else if(t.headers&&!function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}(t.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(c.responseType=t.responseType),"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(c),c.send(p||null),c}T.XMLHttpRequest=r.XMLHttpRequest||function(){},T.XDomainRequest="withCredentials"in new T.XMLHttpRequest?T.XMLHttpRequest:r.XDomainRequest,function(t,e){for(var n=0;n<t.length;n++)e(t[n])}(["get","put","post","patch","head","delete"],function(t){T["delete"===t?"del":t]=function(e,n,o){return(n=O(e,n,o)).method=t.toUpperCase(),R(n)}}),x.default=E;var j,S=function(){function t(t){var o=t.selector,r=t.url,i=n(t,["selector","url"]),a=this;this.attach=function(t,e,n,o){void 0===o&&(o={}),t.addEventListener(e,function(){return a.emit(n,o)})},this.defaultMetadata=function(){return{user_agent:window&&window.navigator&&window.navigator.userAgent,fingerprint:a.getFingerprint(),path:window.location.pathname}},this.getFingerprint=function(){return a.fingerprint?a.fingerprint:document.cookie.replace(/(?:(?:^|.*;\s*)_afid\s*\=\s*([^;]*).*$)|^.*$/,"$1")},this.emit=function(t,o){void 0===o&&(o={});var r=(new Date).getTime(),i=e({},o,a.defaultMetadata()),s=a.baseOptions,c=s.source,u=n(s,["source"]),f={body:JSON.stringify(e({},u,{verb:t,created_at:r,meta:i})),uri:a.url+"/add/"+c+"/",headers:{"Content-Type":"application/json"}};x.post(f,function(){return null})},this.listenToRootRemoval=function(t){t.target===a.root&&(a.rootParent.removeEventListener("DOMNodeRemoved",a.listenToRootRemoval),a.observer.disconnect(),setTimeout(function(){return a.attachObserver()},0))},this.observerCallback=function(t){t.length&&t.forEach(a.attachToAddedNodes)},this.attachToAddedNodes=function(t){var e=t.addedNodes;if(e.length)try{e.forEach(a.attachToIrisNode)}catch(t){Array.prototype.forEach.call(e,a.attachToIrisNode)}},this.attachToIrisNode=function(t){if(!a.checkNodeType(t)){var e=a.getIrisElements(t);e.length&&e.forEach(a.attachEventListener)}},this.attachEventListener=function(t){if(t&&t.getAttributeNames){var e=a.parseIrisOptions(t),n=e.event,o=e.verb,r=e.meta;t.addEventListener(n,function(){return a.emit(o,r)})}},this.url=r,this.baseOptions=i,o&&(this.selector=o,this.setRoot(),this.watchRootDetachment(),this.attachToCurrentNodes(),this.attachObserver())}return t.prototype.setFingerprint=function(t){this.fingerprint=t},t.prototype.setRoot=function(){if(this.root=document.querySelector(this.selector),!this.root)throw new Error("Selector "+this.selector+" does not exist.");if(null===this.root.parentElement)throw new Error("Selector ("+this.selector+") is not attached to the document")},t.prototype.watchRootDetachment=function(){var t=this;this.rootParent=this.root.parentElement,this.rootParent.addEventListener("DOMNodeRemoved",function(e){t.listenToRootRemoval(e)})},t.prototype.attachObserver=function(){this.observer=new MutationObserver(this.observerCallback),this.observer.observe(this.root,{childList:!0,subtree:!0})},t.prototype.attachToCurrentNodes=function(){var t=this.getIrisElements(this.root)||[];Object.keys(t).map(function(e){return t[e]}).forEach(this.attachEventListener)},t.prototype.checkNodeType=function(t){return!(t instanceof HTMLElement)||t instanceof HTMLScriptElement||t instanceof HTMLStyleElement},t.prototype.getIrisElements=function(t){return t.querySelectorAll("[iris]")},t.prototype.parseIrisOptions=function(t){var n=t.getAttributeNames().filter(function(t){return/^iris-/.test(t)}).map(function(t){return t.replace("iris-","")}),o=n.filter(function(t){return!/^meta/.test(t)}).filter(Boolean),r=(n.filter(function(t){return/^meta/.test(t)}).map(function(t){return t.replace("meta-","")}).filter(Boolean),{}),i={};return o.map(function(e){r[e]=t.getAttribute("iris-"+e),i[e]=t.getAttribute("iris-meta-"+e)}),n.forEach(function(e){return t.removeAttribute("iris-"+e)}),t.removeAttribute("iris"),e({},r,{meta:i})},t}();var L="function"==typeof Symbol?Symbol("iris"):"iris",M=((j={})[L]=null,j.init=function(t){if(this[L])return this[L];if(t.selector&&"undefined"==typeof MutationObserver)return!1;var e=document.cookie.replace(/(?:(?:^|.*;\s*)aid\s*\=\s*([^;]*).*$)|^.*$/,"$1");""===e&&(e=document.cookie.replace(/(?:(?:^|.*;\s*)_afid\s*\=\s*([^;]*).*$)|^.*$/,"$1")),""===e&&(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),window.location.hostname.endsWith("teachable.com")?(document.cookie="_afid="+e+"; max-age=31536000; path=/; domain=.teachable.com",document.cookie="aid="+e+"; max-age=31536000; path=/; domain=.teachable.com"):window.location.hostname.endsWith("zeachable.cloud")?document.cookie="aid="+e+"; max-age=31536000; path=/; domain=.zeachable.cloud":window.location.hostname.endsWith("worksonmy.computer")?document.cookie="aid="+e+"; max-age=31536000; path=/; domain=.worksonmy.computer":document.cookie="aid="+e+"; max-age=31536000; path=/"),t.noun_id||(t.noun_id=e);var n=new S(t);return this[L]=n,this[L].setFingerprint(e),window.iris=n,this[L]},j);t.iris=M,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=iris.umd.min.js.map
